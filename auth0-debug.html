<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Auth0 Debug Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .test-section {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #ccc;
        border-radius: 5px;
      }
      .success {
        background: #d4edda;
        border-color: #c3e6cb;
      }
      .error {
        background: #f8d7da;
        border-color: #f5c6cb;
      }
      .info {
        background: #d1ecf1;
        border-color: #bee5eb;
      }
      pre {
        background: #f8f9fa;
        padding: 10px;
        border-radius: 3px;
        overflow-x: auto;
      }
      button {
        padding: 10px 15px;
        margin: 5px;
        border: none;
        border-radius: 3px;
        cursor: pointer;
      }
      .primary {
        background: #007bff;
        color: white;
      }
      .secondary {
        background: #6c757d;
        color: white;
      }
      .success-btn {
        background: #28a745;
        color: white;
      }
    </style>
  </head>
  <body>
    <h1>ğŸ” VitalSense Auth0 Debug Test</h1>

    <div class="test-section info">
      <h3>ğŸ§ª Live Debugging</h3>
      <p>
        This page will test the Auth0 configuration and identify why the login
        button isn't working.
      </p>
      <button class="primary" onclick="runDebugTests()">
        ğŸ” Run Debug Tests
      </button>
      <button class="secondary" onclick="testProductionLogin()">
        ğŸŒ Test Production Login
      </button>
      <button class="success-btn" onclick="testDemoMode()">
        ğŸš€ Test Demo Mode
      </button>
    </div>

    <div id="test-results"></div>

    <div class="test-section info">
      <h3>ğŸ“‹ Auth0 Configuration</h3>
      <pre>
Domain: dev-qjdpc81dzr7xrnlu.us.auth0.com
Client ID: 3SWqx7E8dFSIWapIikjppEKQ5ksNxRAQ
Production URL: https://health.andernet.dev</pre
      >
    </div>

    <div class="test-section info">
      <h3>ğŸ”§ Console Output</h3>
      <p>Open browser console (F12) to see detailed logs during testing.</p>
      <div
        id="console-output"
        style="
          background: #000;
          color: #0f0;
          padding: 10px;
          border-radius: 3px;
          font-family: monospace;
          min-height: 100px;
          white-space: pre-wrap;
        "
      ></div>
    </div>

    <script>
      // Capture console logs and display them
      const originalLog = console.log;
      const consoleOutput = document.getElementById('console-output');

      console.log = function (...args) {
        originalLog.apply(console, args);
        consoleOutput.textContent += args.join(' ') + '\n';
        consoleOutput.scrollTop = consoleOutput.scrollHeight;
      };

      function addResult(type, title, message) {
        const resultsDiv = document.getElementById('test-results');
        const div = document.createElement('div');
        div.className = `test-section ${type}`;
        div.innerHTML = `<h3>${title}</h3><p>${message}</p>`;
        resultsDiv.appendChild(div);
      }

      async function runDebugTests() {
        console.log('ğŸ” Starting Auth0 Debug Tests...');
        addResult(
          'info',
          'ğŸ” Debug Tests Started',
          'Running comprehensive Auth0 diagnostics...'
        );

        // Test 1: Auth0 Domain Accessibility
        try {
          console.log('ğŸ“¡ Testing Auth0 domain accessibility...');
          const response = await fetch(
            'https://dev-qjdpc81dzr7xrnlu.us.auth0.com/.well-known/openid_configuration'
          );
          if (response.ok) {
            const config = await response.json();
            console.log('âœ… Auth0 domain accessible:', config.issuer);
            addResult(
              'success',
              'âœ… Auth0 Domain Test',
              `Domain is accessible. Issuer: ${config.issuer}`
            );
          } else {
            console.log('âŒ Auth0 domain returned status:', response.status);
            addResult(
              'error',
              'âŒ Auth0 Domain Test',
              `Domain returned HTTP ${response.status}. This is likely the main issue!`
            );
          }
        } catch (error) {
          console.log('âŒ Auth0 domain error:', error.message);
          addResult(
            'error',
            'âŒ Auth0 Domain Test',
            `Cannot reach domain: ${error.message}`
          );
        }

        // Test 2: Check if Auth0 script loads
        console.log('ğŸ“„ Testing Auth0 script loading...');
        if (typeof auth0 !== 'undefined') {
          console.log('âœ… Auth0 script loaded successfully');
          addResult(
            'success',
            'âœ… Auth0 Script Test',
            'Auth0 library is available'
          );
        } else {
          console.log('âŒ Auth0 script not loaded');
          addResult(
            'error',
            'âŒ Auth0 Script Test',
            'Auth0 library is not available'
          );
        }

        // Test 3: Try to initialize Auth0
        try {
          console.log('ğŸ”§ Testing Auth0 initialization...');
          if (typeof auth0 !== 'undefined') {
            const testAuth = new auth0.WebAuth({
              domain: 'dev-qjdpc81dzr7xrnlu.us.auth0.com',
              clientID: '3SWqx7E8dFSIWapIikjppEKQ5ksNxRAQ',
              redirectUri: 'https://health.andernet.dev/callback',
              responseType: 'code',
              scope: 'openid profile email',
            });
            console.log('âœ… Auth0 WebAuth initialized successfully');
            addResult(
              'success',
              'âœ… Auth0 Initialization Test',
              'Auth0 WebAuth can be created successfully'
            );
          } else {
            console.log(
              'âŒ Cannot test Auth0 initialization - script not loaded'
            );
            addResult(
              'error',
              'âŒ Auth0 Initialization Test',
              'Cannot test - Auth0 script not loaded'
            );
          }
        } catch (error) {
          console.log('âŒ Auth0 initialization error:', error.message);
          addResult(
            'error',
            'âŒ Auth0 Initialization Test',
            `Initialization failed: ${error.message}`
          );
        }

        console.log('ğŸ Debug tests completed');
        addResult(
          'info',
          'ğŸ Debug Complete',
          'Check the results above to identify issues.'
        );
      }

      function testProductionLogin() {
        console.log('ğŸŒ Testing production login page...');
        addResult(
          'info',
          'ğŸŒ Production Login Test',
          'Opening production login page in new tab...'
        );
        window.open('https://health.andernet.dev/login', '_blank');
      }

      function testDemoMode() {
        console.log('ğŸš€ Testing demo mode...');
        addResult(
          'info',
          'ğŸš€ Demo Mode Test',
          'Opening demo mode in new tab...'
        );
        window.open('https://health.andernet.dev/?demo=true', '_blank');
      }

      // Auto-start basic tests
      console.log('ğŸ¯ Auth0 Debug Page Loaded');
      console.log('ğŸ‘† Click "Run Debug Tests" to start comprehensive testing');
    </script>

    <!-- Load Auth0 script for testing -->
    <script src="https://cdn.auth0.com/js/auth0/9.23.2/auth0.min.js"></script>
  </body>
</html>
